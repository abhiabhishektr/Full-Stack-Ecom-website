var formData = {
    key: response.key_id,
    amount: response.amount,
    currency: 'INR',
    name: response.product_name,
    description: response.description,
    image: '',
    order_id: response.orderId,
    handler: function (paymentResponse) {
        // Handle the successful payment response
        Swal.fire({
            icon: 'success',
            title: 'Payment Succeeded',
            text: 'Your payment was successful!',
        }).then(() => {
            // Make the AJAX request to '/success'
            $.ajax({
                url: '/success',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({
                    razorpayOrderId: response.orderId,
                    paymentResponse: paymentResponse,
                    mongodbOrderIds: response.mongodbOrderId,
                }),
                success: function (serverResponse) {
                    console.log('Server Response:', serverResponse);
                },
                error: function (xhr, status, error) {
                    console.error('Ajax error:', status, error);
                }
            });
        });
    },
    prefill: {
        contact: response.contact,
        name: response.name,
        email: response.email
    }
};

// Call the Razorpay payment handler with the options
var rzp = new Razorpay(formData);

// Handle payment failure with SweetAlert
rzp.on('payment.failed', function (response) {
    Swal.fire({
        icon: 'error',
        title: 'Payment failed',
        text: 'Oops! Something went wrong with your payment.',
    }).then(() => {
        // Make the AJAX request to '/failure'
        $.ajax({
            url: '/failure',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({
                razorpayOrderId: response.razorpay_order_id,
                error: response.error,
                paymentResponse: response,
                mongodbOrderIds: response.notes.mongodbOrderId
            }),
            success: function (serverResponse) {
                console.log('Server Response:', serverResponse);
            },
            error: function (xhr, status, error) {
                console.error('Ajax error:', status, error);
            }
        });
    });
});
